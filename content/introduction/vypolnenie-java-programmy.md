## Выполнение Java-программы

Как вы знаете, программа, написанная на одном из языков высокого уровня, к которым относится и язык Java, так называемый _исходный модуль_ ("исходник" или "сырец" на жаргоне, от английского "source"), не может быть сразу же выполнена. Её сначала надо откомпилировать, т.е. перевести в последовательность машинных команд - _объектный модуль_. Но и он, как правило, не может быть сразу же выполнен: объектный модуль надо ещё скомпоновать с библиотеками использованных в модуле функций и разрешить перекрёстные ссылки между секциями объектного модуля, получив в результате _загрузочный модуль_ - полностью готовую к выполнению программу.

Исходный модуль, написанный на Java, не может избежать этих процедур, но здесь проявляется главная особенность технологии Java - программа компилируется сразу в машинные команды, но не команды какого-то конкретного процессора, а в команды так называемой виртуальной машины Java (_Java Virtual Machine, JVM_). _Виртуальная машина Java_ - это совокупность команд вместе с системой их выполнения. Для специалистов скажем, что виртуальная машина Java полностью стековая, так что не требуется сложная адресация ячеек памяти и большое количество регистров. Поэтому команды _JVM_ короткие, большинство из них имеет длину 1 байт, отчего команды _JVM_ называют _байт-кодами (bytecodes)_, хотя имеются команды длиной 2 и 3 байта. Согласно статистическим исследованиям средняя длина команды составляет 1,8 байта. Полное описание команд и всей архитектуры _JVM_ содержится в _спецификации виртуальной машины Java (Virtual Machine Specification, VMS)_. Если вы хотите в точности узнать, как работает виртуальная машина Java, ознакомьтесь с этой спецификацией. 

Другая особенность Java - все стандартные функции, вызываемые в программе, подключаются к ней только на этапе выполнения, а не включаются в байт-коды. Как говорят специалисты, происходит _динамическая компоновка (dynamic binding)_. Это тоже сильно уменьшает объём откомпилированной программы.

Итак, на первом этапе программа, написанная на языке Java, переводится компилятором в байт-коды. Эта компиляция не зависит от типа какого-либо конкретного процессора и архитектуры некоего конкретного компьютера. Она может быть выполнена один раз сразу же после написания программы. Байт-коды записываются в одном или нескольких файлах, могут храниться во внешней памяти или передаваться по сети. Это особенно удобно благодаря небольшому размеру файлов с байт-кодами. Затем полученные в результате компиляции байт-коды можно выполнять на любом компьютере, имеющем систему, реализующую _JVM_. При этом не важен ни тип процессора, ни архитектура компьютера. Так реализуется принцип Java _"Write once, run anywhere"_ - "Написано однажды, выполняется где угодно".

Интерпретация байт-кодов и динамическая компоновка значительно замедляют выполнение программ. Это не имеет значения в тех ситуациях, когда байт-коды передаются по сети, сеть всё равно медленнее любой интерпретации, но в других ситуациях требуется мощный и быстрый компьютер. Поэтому постоянно идёт усовершенствование интерпретаторов в сторону увеличения скорости интерпретации. Разработаны _JIT-компиляторы (Just-In-Time)_, запоминающие уже интерпретированные участки кода в машинных командах процессора и просто выполняющие эти участки при повторном обращении, например, в циклах. Это значительно увеличивает скорость повторяющихся вычислений. Фирма Sun Microsystems разработала целую технологию HotSpot и включает её в свою виртуальную машину Java. Но, конечно, наибольшую скорость может дать только специализированный процессор.

Фирма Sun Microsystems выпустила микропроцессоры PicoJava, работающие на системе команд _JVM_, и собирается выпускать целую линейку всё более мощных Java-процессоров. Есть уже и Java-процессоры других фирм. Эти процессоры непосредственно выполняют байт-коды. Но при выполнении программ Java на других процессорах требуется ещё интерпретация команд _JVM_ в команды конкретного процессора, а значит, нужна программа-интерпретатор, причём для каждого типа процессоров и для каждой архитектуры компьютера следует написать свой интерпретатор.

Эта задача уже решена практически для всех компьютерных платформ. На них реализованы виртуальные машины Java, а для наиболее распространённых платформ имеется несколько реализаций _JVM_ разных фирм. Всё больше операционных систем и систем управления базами данных включают реализацию _JVM_ в своё ядро. Создана и специальная операционная система _JavaOS_, применяемая в электронных устройствах. В большинство браузеров встроена виртуальная машина Java для выполнения апплетов.

Программы, приведённые в этой книге, выполнялись в операционных системах: MS Windows 2000/XP/Server 2003, Red Hat Linux, Fedora Core Linux, без перекомпиляции. Это видно по рисункам, приведённым во многих главах книги. Они "сняты" с экранов графических оболочек разных операционных систем.

Внимательный читатель уже заметил, что кроме реализации _JVM_ для выполнения байт-кодов на компьютере ещё нужно иметь набор функций, вызываемых из байт-кодов и динамически компонующихся с байт-кодами. Этот набор оформляется в виде библиотеки классов Java, состоящей из одного или нескольких _пакетов_. Каждая функция может быть записана байт-кодами, но, поскольку она будет храниться на конкретном компьютере, её можно записать прямо в системе команд этого компьютера, избегнув тем самым интерпретации байт-кодов. Такие функции называются _"родными" методами (native methods)_. Применение _"родных" методов_ ускоряет выполнение программы.

Фирма Sun Microsystems - создатель технологии Java - бесплатно распространяет набор необходимых программных инструментов для полного цикла работы с этим языком программирования: компиляции, интерпретации, отладки, включающий и богатую библиотеку классов, под названием _JDK (Java Development Kit)_. Есть наборы инструментальных программ и других фирм. Например, большой популярностью пользуется _JDK_ фирмы IBM.
